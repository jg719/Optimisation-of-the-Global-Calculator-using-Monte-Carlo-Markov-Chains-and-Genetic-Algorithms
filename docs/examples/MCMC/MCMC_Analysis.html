<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Optimisation of the Global Calculator via Monte Carlo Markov Chains &#8212; Optimisation of the Global Calculator 25/07/2020 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="License" href="../../license/license.html" />
    <link rel="prev" title="Optimisation of the Global Calculator via Genetic Algorithms" href="../GA/GA_Analysis.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          Optimisation of the Global Calculator</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../optimisation_constraints/constraints.html">Sample optimisation constraints</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../MCMC_analysis.html">Monte Carlo Markov Chain analysis</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GA_Analysis.html">Genetic algorithms optimiser</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CMAES_analysis.html">Covariance Matrix Adaption Evolutionary Strategy analysis</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ANN_analysis.html">Artificial Neural Networks analysis</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GA/GA_Analysis.html">Optimisation of the Global Calculator via Genetic Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GA/GA_Analysis.html#set-up">Set-up</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#creating-a-new-generation">Creating a new generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#fitness-function">Fitness function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#selection">Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#mutation">Mutation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#crossover">Crossover</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#enabling-multiple-constraints">Enabling multiple constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#defining-the-optimisation-constraints">Defining the optimisation constraints</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../GA/GA_Analysis.html#optimisation">Optimisation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#iterations">Iterations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GA/GA_Analysis.html#cost-minimisation">Cost minimisation</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimisation of the Global Calculator via Monte Carlo Markov Chains</a></li>
<li class="toctree-l1"><a class="reference internal" href="#set-up">Set-up</a></li>
<li class="toctree-l1"><a class="reference internal" href="#temperature-sensitivity-analysis">Temperature sensitivity analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="#cost-sensitivity-analysis">Cost sensitivity analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="#generalising-mcmc-2-constraints-to-all-levers">Generalising MCMC (2 constraints) to all levers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#unbounded-prior-for-all-levers">Unbounded prior for all levers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-observations">Generating observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-a-likelihood-function">Defining a likelihood function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#running-mcmc-and-logging-results">Running MCMC and logging results</a></li>
<li class="toctree-l1"><a class="reference internal" href="#loading-pre-computed-results-24-hours-long-markov-chain">Loading pre-computed results (24-hours long Markov Chain)</a></li>
<li class="toctree-l1"><a class="reference internal" href="#correlation-matrix-of-accepted-mcmc-lever-combinations">Correlation matrix of accepted MCMC lever combinations</a></li>
<li class="toctree-l1"><a class="reference internal" href="#paired-density-and-scatter-plot-matrix-of-lever-combinations-accepted-by-mcmc">Paired density and scatter plot matrix of lever combinations accepted by MCMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="#correlation-matrix-of-output-values">Correlation matrix of output values</a></li>
<li class="toctree-l1"><a class="reference internal" href="#export-correlation-data-to-gephi">Export correlation data to GEPHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="#posterior-distribution-of-accepted-mcmc-lever-combinations">Posterior distribution of accepted MCMC lever combinations</a></li>
<li class="toctree-l1"><a class="reference internal" href="#posterior-distribution-of-model-outputs-accepted-by-mcmc">Posterior distribution of model outputs accepted by MCMC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#evolution-of-temperature-values">Evolution of temperature values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evolution-of-cost-values">Evolution of cost values</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#acceptance-rate">Acceptance rate</a></li>
<li class="toctree-l1"><a class="reference internal" href="#autocorrelation-function-of-accepted-model-outputs">Autocorrelation function of accepted model outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="#summary-of-inputs-to-the-global-calculator">Summary of inputs to the Global Calculator</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../license/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license/requirements.html">Requirements</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Optimisation of the Global Calculator via Monte Carlo Markov Chains</a></li>
<li><a class="reference internal" href="#set-up">Set-up</a></li>
<li><a class="reference internal" href="#temperature-sensitivity-analysis">Temperature sensitivity analysis</a></li>
<li><a class="reference internal" href="#cost-sensitivity-analysis">Cost sensitivity analysis</a></li>
<li><a class="reference internal" href="#generalising-mcmc-2-constraints-to-all-levers">Generalising MCMC (2 constraints) to all levers</a><ul>
<li><a class="reference internal" href="#unbounded-prior-for-all-levers">Unbounded prior for all levers</a></li>
<li><a class="reference internal" href="#generating-observations">Generating observations</a></li>
<li><a class="reference internal" href="#defining-a-likelihood-function">Defining a likelihood function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-mcmc-and-logging-results">Running MCMC and logging results</a></li>
<li><a class="reference internal" href="#loading-pre-computed-results-24-hours-long-markov-chain">Loading pre-computed results (24-hours long Markov Chain)</a></li>
<li><a class="reference internal" href="#correlation-matrix-of-accepted-mcmc-lever-combinations">Correlation matrix of accepted MCMC lever combinations</a></li>
<li><a class="reference internal" href="#paired-density-and-scatter-plot-matrix-of-lever-combinations-accepted-by-mcmc">Paired density and scatter plot matrix of lever combinations accepted by MCMC</a></li>
<li><a class="reference internal" href="#correlation-matrix-of-output-values">Correlation matrix of output values</a></li>
<li><a class="reference internal" href="#export-correlation-data-to-gephi">Export correlation data to GEPHI</a></li>
<li><a class="reference internal" href="#posterior-distribution-of-accepted-mcmc-lever-combinations">Posterior distribution of accepted MCMC lever combinations</a></li>
<li><a class="reference internal" href="#posterior-distribution-of-model-outputs-accepted-by-mcmc">Posterior distribution of model outputs accepted by MCMC</a><ul>
<li><a class="reference internal" href="#evolution-of-temperature-values">Evolution of temperature values</a></li>
<li><a class="reference internal" href="#evolution-of-cost-values">Evolution of cost values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acceptance-rate">Acceptance rate</a></li>
<li><a class="reference internal" href="#autocorrelation-function-of-accepted-model-outputs">Autocorrelation function of accepted model outputs</a></li>
<li><a class="reference internal" href="#summary-of-inputs-to-the-global-calculator">Summary of inputs to the Global Calculator</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../GA/GA_Analysis.html" title="Previous Chapter: Optimisation of the Global Calculator via Genetic Algorithms"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Optimisation ...</span>
    </a>
  </li>
  <li>
    <a href="../../license/license.html" title="Next Chapter: License"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">License &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../_sources/examples/MCMC/MCMC_Analysis.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="optimisation-of-the-global-calculator-via-monte-carlo-markov-chains">
<h1>Optimisation of the Global Calculator via Monte Carlo Markov Chains<a class="headerlink" href="#optimisation-of-the-global-calculator-via-monte-carlo-markov-chains" title="Permalink to this headline">¶</a></h1>
<p>This investigation aims to generate different climate change mitigation
pathways with the “Global Calculator” - a complex model used to forecast
the world’s energy, food and land systems to 2050
(<a class="reference external" href="http://tool.globalcalculator.org/">http://tool.globalcalculator.org/</a>). Performing a constrained
optimisation of the model’s input parameter space yields alternative
pathways to sustainability.</p>
<p>The key challenge of such an optimisation is to explore a broad
parameter space (~9e50 different parameter combinations) rapidly.</p>
<p>The optimisation constraints can be expressed as probability
distributions. MCMC can be used to find the probability distribution of
each lever that maximises the probability of the output distribution.</p>
<p>In this analysis, two constraints are imposed. The temperature
constraint ensures compliance of the 2C warming limit while the cost
constraint ensures a cost at most equal to the business as usual
scenario (as described by the IEA 6DS pathway).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">openpyxl</span> <span class="k">import</span> <span class="n">load_workbook</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="k">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">import</span> <span class="nn">selenium</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="k">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="k">import</span> <span class="n">ElementClickInterceptedException</span>
<span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="k">import</span> <span class="n">ChromeDriverManager</span>

<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">multivariate_normal</span>

<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="k">import</span> <span class="n">plot_pacf</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="k">import</span> <span class="n">plot_acf</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up">
<h1>Set-up<a class="headerlink" href="#set-up" title="Permalink to this headline">¶</a></h1>
<p>Use selenium to open Chrome and access the Global Calculator.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">())</span> <span class="c1"># set browser</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">WDM</span><span class="p">]</span> <span class="o">-</span> <span class="n">Current</span> <span class="n">google</span><span class="o">-</span><span class="n">chrome</span> <span class="n">version</span> <span class="ow">is</span> <span class="mf">84.0</span><span class="o">.</span><span class="mi">4147</span>
<span class="p">[</span><span class="n">WDM</span><span class="p">]</span> <span class="o">-</span> <span class="n">Get</span> <span class="n">LATEST</span> <span class="n">driver</span> <span class="n">version</span> <span class="k">for</span> <span class="mf">84.0</span><span class="o">.</span><span class="mi">4147</span>
</pre></div>
</div>
<pre class="literal-block">[WDM] - Get LATEST driver version for 84.0.4147
[WDM] - Trying to download new driver from <a class="reference external" href="http://chromedriver.storage.googleapis.com/84.0.4147.30/chromedriver_win32.zip">http://chromedriver.storage.googleapis.com/84.0.4147.30/chromedriver_win32.zip</a>
[WDM] - Driver has been saved in cache [C:Users44783.wdmdriverschromedriverwin3284.0.4147.30]</pre>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://tool.globalcalculator.org/&#39;</span><span class="p">)</span> <span class="c1"># open website</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># bypass &quot;Start&quot; screen</span>
<span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;Output_map.xlsx&quot;</span><span class="p">)</span> <span class="c1"># file mapping output lever names to xpaths</span>
<span class="n">dfs_3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;Input_map.xlsx&quot;</span><span class="p">)</span> <span class="c1"># file mapping input names to xpaths</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)):</span> <span class="c1"># generate html lever addresses and put them in the dataframe</span>
    <span class="n">dfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/html/body/table[1]/tbody/tr/td/table/tbody/tr[2]/td[1]/div[13]/div/table/tbody/tr[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]/td[5]/div/font&#39;</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># each letter corresponds to a lever value: a = 1.0; b = 1.1; c = 1.2; ... C = 3.9; D = 4.0</span>
<span class="n">lever_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span> <span class="c1"># Create list with all lever names</span>
<span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># move_lever(lever_names, [2.9, 2.3, 2.3, 2.9, 2.7, 2.7, 2.9, 3.0, 2.8, 3.1, 2.0, 2.9, 2.7, 2.2, 1.8, 2.9, 3.0, 1.8, 1.8, 2.9, 2.3, 1.9, 1, 3.0, 3.0, 1.6, 2.7, 1.6, 2.3, 2.9, 1.9, 2.0, 3.0, 4.0, 1.8, 2.8, 2.6, 2.5, 3.0, 2.4, 3.0, 2.0, 2.7, 1, 1, 1, 1, 3.1] )</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">open_lever_menus</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Opens all the lever menus of the Global Calculator&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span> <span class="c1"># Iterate through menus</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># Tries to open the menu</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;ml-open-close-link-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span>  <span class="s1">&#39;&quot;]&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span> <span class="c1"># Open menu</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># Server can&#39;t respond quicker than this</span>
        <span class="k">except</span> <span class="n">ElementClickInterceptedException</span><span class="p">:</span> <span class="c1"># If opening menus too fast, then slow down</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;ml-open-close-link-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span>  <span class="s1">&#39;&quot;]&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">find_lever_ref</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a lever name and box position, return its XPath&quot;&quot;&quot;</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="n">dfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># Get lever xpath</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">box</span><span class="p">)</span> <span class="o">+</span> <span class="n">ref</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="c1"># Adjust address for given box</span>
    <span class="k">return</span> <span class="n">ref</span>

<span class="k">def</span> <span class="nf">read_lever</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a lever name, return its ID&quot;&quot;&quot;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="n">dfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="c1"># Find lever ID</span>
    <span class="k">return</span> <span class="s1">&#39;fb-l-&#39;</span> <span class="o">+</span> <span class="n">pos</span>

<span class="k">def</span> <span class="nf">read_CO2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;For the current lever combination, return the CO2 level (GtCO2)&quot;&quot;&quot;</span>
    <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;container_dashboard_co2_budget&quot;]&#39;</span><span class="p">)</span> <span class="c1"># Find element that contains CO2 value</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">co2</span> <span class="o">=</span> <span class="n">userid_element</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="c1"># Get CO2 value from the container</span>
    <span class="k">return</span> <span class="n">co2</span>

<span class="k">def</span> <span class="nf">read_outputs</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Reads all outputs and returns them as a list&quot;&quot;&quot;</span>
    <span class="n">compare_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;mp-nav-compare&quot;]&#39;</span><span class="p">)</span> <span class="c1"># Move to the &quot;Compare&quot; section</span>
    <span class="n">compare_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">out_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)):</span>
        <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">out_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">userid_element</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;mn-1&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span> <span class="c1"># Problem going back to the overview section? The code below sorts it</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># Bypass &quot;Start&quot; screen</span>
        <span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">out_vals</span>

<span class="k">def</span> <span class="nf">map_to_letter</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes a float value in the range [1, 4.0] and returns its corresponding URL character&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># Special cases</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">back</span> <span class="o">=</span> <span class="n">letters</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span> <span class="c1"># Oops, the value is out of bounds</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not enough letters, fetching position: &quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s2">&quot; corresponding to value: &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Special case: Value = 4</span>
            <span class="n">back</span> <span class="o">=</span> <span class="n">letters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">back</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">back</span>

<span class="k">def</span> <span class="nf">random_URL</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generates and return a random URL (address) and its corresponding lever values (input_levers)&quot;&quot;&quot;</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">input_levers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># URL address to be stored here</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">49</span><span class="p">):</span> <span class="c1"># Generate a random value for each lever, map it to a letter and save it</span>
        <span class="n">rand_float</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span> <span class="c1"># Define bounds for random number generator (currently set to [1.8, 3.2])</span>
        <span class="n">input_levers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rand_float</span><span class="p">);</span> <span class="n">address</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">map_to_letter</span><span class="p">(</span><span class="n">rand_float</span><span class="p">))</span> <span class="c1"># Store them</span>
    <span class="n">address</span><span class="p">[</span><span class="mi">43</span><span class="p">:</span><span class="mi">47</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># CCS values are fixed at 1 for the moment</span>
    <span class="n">input_levers</span><span class="p">[</span><span class="mi">43</span><span class="p">:</span><span class="mi">47</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># CCS values are fixed at 1 for the moment</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">address</span><span class="p">:</span> <span class="c1"># Construct string containing the current lever combination</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;http://tool.globalcalculator.org/globcalc.html?levers=&quot;</span> <span class="o">+</span> <span class="n">string</span> <span class="o">+</span> <span class="s2">&quot;2211111111/technology/en&quot;</span> <span class="c1"># Construct URL address</span>
    <span class="k">return</span> <span class="n">address</span><span class="p">,</span> <span class="n">input_levers</span>

<span class="k">def</span> <span class="nf">training_sample</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generates a random training sample. It returns the input (input_levers) and output (random_output) values&quot;&quot;&quot;</span>
    <span class="n">address</span><span class="p">,</span> <span class="n">input_levers</span> <span class="o">=</span> <span class="n">random_URL</span><span class="p">()</span> <span class="c1"># Generate random URL address</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="c1"># Open that URL address</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># Bypass &quot;Start now&quot; menu</span>
    <span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">compare_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;mp-nav-compare&quot;]&#39;</span><span class="p">)</span> <span class="c1"># Move to the &quot;Compare&quot; section</span>
    <span class="n">compare_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">random_output</span> <span class="o">=</span> <span class="n">read_outputs</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="c1"># Read output</span>
    <span class="k">return</span>  <span class="n">input_levers</span><span class="p">,</span> <span class="n">random_output</span>

<span class="k">def</span> <span class="nf">log_training_sample</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generate training sample and save it to a CSV file&quot;&quot;&quot;</span>
    <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span> <span class="o">=</span> <span class="n">training_sample</span><span class="p">()</span> <span class="c1"># Generate random training sample</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Training_set.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="c1"># Append as Excel row</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">Input</span> <span class="o">+</span> <span class="n">Output</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">find_lever_URL_position</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a lever name, return its position in the URL&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">dfs_3</span><span class="p">[</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># Get lever position to insert in the URL</span>

<span class="k">def</span> <span class="nf">new_URL</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;http://tool.globalcalculator.org/globcalc.html?levers=l2wz222CBpp3pC3f2Dw3DC3plzgj1tA13pp2p223ri11111p22211111111/dashboard/en&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a new URL address by changing a lever value.</span>
<span class="sd">        Parameters:</span>
<span class="sd">        - Name (string): Target lever name</span>
<span class="sd">        - Value (float): Target value for lever</span>
<span class="sd">        - Address (string): URL where lever will be changed. Set to TIAM-UCL 2DS pathway by default.</span>
<span class="sd">        Returns:</span>
<span class="sd">        - URL (string): URL after changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">map_to_letter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c1"># Map value to letter</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">find_lever_URL_position</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="c1"># Find URL position of given lever</span>
    <span class="n">URL</span> <span class="o">=</span> <span class="n">address</span><span class="p">[</span> <span class="p">:</span> <span class="mi">53</span> <span class="o">+</span> <span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="n">address</span><span class="p">[</span><span class="mi">54</span> <span class="o">+</span> <span class="n">index</span> <span class="p">:]</span> <span class="c1"># Insert given value in its corresponding URL position</span>
    <span class="k">return</span> <span class="n">URL</span>

<span class="k">def</span> <span class="nf">find_lever_sensitivities</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analysis of climate impact sensitivity to changes in the inputs.</span>
<span class="sd">    Takes the default pathway (TIAM UCL 2DS) and changes each lever value at a time (between 1.0 and 4.0),</span>
<span class="sd">    reading its corresponding output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_sensitivities</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span> <span class="c1"># Store lever sensitivities here</span>
    <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Counter used for indexing</span>
    <span class="k">for</span> <span class="n">lever</span> <span class="ow">in</span> <span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span> <span class="c1"># Iterate through levers, uncomment for testing:  # print(&quot;Putting lever: &quot;, lever, &quot; in column: &quot;, col)</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span> <span class="c1"># Move lever one increment at a time</span>
            <span class="n">sensitivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">move_lever</span><span class="p">([</span><span class="n">lever</span><span class="p">],</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]))</span> <span class="c1"># Move lever and store CO2 value # print(sensitivity)</span>
        <span class="n">all_sensitivities</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensitivity</span> <span class="c1"># Append</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">set_to_benchmark</span><span class="p">()</span> <span class="c1"># Reset levers to benchmark pathway</span>
    <span class="c1">### Plotting routine ###</span>
    <span class="n">x_lever</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="c1"># X axis</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="mi">3000</span> <span class="c1"># Mean threshold</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">mean</span><span class="o">*</span><span class="mf">0.05</span> <span class="c1"># Upper threshold</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">mean</span><span class="o">*</span><span class="mf">0.05</span> <span class="c1"># Lower threshold</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_lever</span><span class="p">,</span> <span class="n">all_sensitivities</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Temperature values and thresholds&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Lever position&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 per capita&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="c1"># Plot thresholds</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">upper</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">2250</span><span class="p">,</span> <span class="mi">3750</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">48</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">lever_number</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_sensitivities</span><span class="o">.</span><span class="n">T</span><span class="p">:</span> <span class="c1"># Calculate lever values corresponding to thresholds</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">upper</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&gt;</span><span class="n">lower</span><span class="p">:</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x_lever</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">thresholds</span><span class="p">[</span><span class="n">lever_number</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">temp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">temp</span><span class="p">))],</span> <span class="n">pos</span><span class="p">[</span><span class="n">temp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">temp</span><span class="p">))]]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Temperature values within thresholds&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Lever position&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 per capita&quot;</span><span class="p">)</span>
        <span class="n">lever_number</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">48</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lever ranges that meet temperature thresholds&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Value range&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Lever&quot;</span><span class="p">)</span>
    <span class="c1">### End of plotting routine ###</span>
    <span class="k">return</span> <span class="n">thresholds</span>

<span class="k">def</span> <span class="nf">lever_step</span><span class="p">(</span><span class="n">lever_value</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Naive modification of the Metropolis Hastings algorithm - moves a lever randomly up or down by 0.1. Return the new lever value&quot;&quot;&quot;</span>
    <span class="n">move</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span> <span class="c1"># Generate random number</span>
    <span class="k">if</span> <span class="n">prob</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span> <span class="n">move</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span> <span class="c1"># Move lever down</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">move</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># Move lever up</span>
    <span class="c1"># If the lever value is out of bounds, reverse direction of step</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lever_value</span> <span class="o">+</span> <span class="n">move</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lever_value</span> <span class="o">+</span> <span class="n">move</span> <span class="o">&gt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">move</span> <span class="o">=</span> <span class="o">-</span><span class="n">move</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">lever_value</span> <span class="o">+</span> <span class="n">move</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cost_sensitivity</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analysis of GDP sensitivity to changes in the inputs.</span>
<span class="sd">    Sets all levers to 2 and moves each lever to 3 at a time,</span>
<span class="sd">    reading its corresponding output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">lever</span> <span class="ow">in</span> <span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span> <span class="c1"># Set all levers to 2</span>
        <span class="n">move_lever</span><span class="p">([</span><span class="n">lever</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">costs_sensitivity</span> <span class="o">=</span>  <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lever</span> <span class="ow">in</span> <span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span> <span class="c1"># Move each lever to 3 at a time</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving lever: &quot;</span><span class="p">,</span> <span class="n">lever</span><span class="p">)</span>
        <span class="n">costs_temp</span> <span class="o">=</span> <span class="n">move_lever</span><span class="p">([</span><span class="n">lever</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">costs_sensitivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">costs_temp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Marginal cost: &quot;</span><span class="p">,</span> <span class="n">costs_temp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Returning lever back to normal... </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">move_lever</span><span class="p">([</span><span class="n">lever</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Put the lever back to 2</span>

    <span class="n">reference</span> <span class="o">=</span> <span class="n">move_lever</span><span class="p">([</span><span class="s1">&#39;Calories consumed&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Read the benchmark cost</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Lever&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="c1"># Dictionary containing costs and lever names</span>
            <span class="s1">&#39;Marginal cost&#39;</span><span class="p">:</span> <span class="n">costs_sensitivity</span>
            <span class="p">}</span>

    <span class="n">costs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lever&#39;</span><span class="p">,</span> <span class="s1">&#39;Marginal cost&#39;</span><span class="p">])</span> <span class="c1"># Put cost values into dataframe</span>
    <span class="n">costs_df</span> <span class="o">=</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Marginal cost&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Sort costs</span>
    <span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.08</span> <span class="c1"># Truncate first value (very high, reverses direction of GDP, leading to bug)</span>
    <span class="n">costs_df</span> <span class="o">=</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Marginal cost&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.46</span>
    <span class="n">costs_df</span> <span class="o">=</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Marginal cost&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">costs_df</span><span class="p">[</span><span class="s1">&#39;Marginal cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs_df</span><span class="p">[</span><span class="s1">&#39;Marginal cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference</span> <span class="c1"># Calculate cost change wrt benchmark</span>
    <span class="c1">### Plotting routine ###</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$GDP decrease&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;∆GDP decrease with respect to TIAM-UCL 2DS benchmark pathway – Moving each lever from 2 to 3&quot;</span><span class="p">)</span>
    <span class="c1">### End of plotting routine ###</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">set_to_benchmark</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set Global Calculator to TIMA-UCL 2DS&#39;s benchmark pathway&quot;&quot;&quot;</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://tool.globalcalculator.org/globcalc.html?levers=l2wz222CBpp3pC3f2Dw3DC3plzgj1tA13pp2p223ri11111p22211111111/dashboard/en&#39;</span><span class="p">)</span>
    <span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># Bypass &quot;Start now&quot; screen</span>
    <span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">random_lever_value</span><span class="p">(</span><span class="n">lever_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Moves a given lever (lever_name) to a random position between 1 and 3.9&quot;&quot;&quot;</span>
    <span class="n">rand_val</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">39</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span> <span class="c1"># Generate random value between 1 and 3.9</span>
    <span class="k">return</span> <span class="n">move_lever</span><span class="p">([</span><span class="n">lever_name</span><span class="p">],</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">rand_val</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Move lever and return CO2 and GDP values</span>

<span class="k">def</span> <span class="nf">new_lever_combination</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Returns an array containing a random value for each lever&quot;&quot;&quot;</span>
    <span class="n">random_lever_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lever_names</span><span class="p">)):</span>
        <span class="n">random_lever_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">39</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Generate random lever value</span>
    <span class="k">return</span> <span class="n">random_lever_values</span>

<span class="k">def</span> <span class="nf">generate_mu_proposal_2D</span><span class="p">(</span><span class="n">all_levers_current</span><span class="p">,</span> <span class="n">all_thresholds</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Used in MCMC. Takes arrays containing all current values and thresholds and generates a new mu proposal&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lever_names</span><span class="p">)):</span> <span class="c1"># Take discrete MH step for each lever</span>
        <span class="n">all_levers_current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lever_step</span><span class="p">(</span><span class="n">all_levers_current</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">all_thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># Pass list with all lever names and current values. Read temperature and costs.</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">move_lever</span><span class="p">(</span><span class="n">lever_names</span><span class="p">,</span> <span class="n">all_levers_current</span><span class="p">,</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">address</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_levers_current</span><span class="p">,</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">multi_sampler_2D</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="n">all_levers_current</span><span class="p">,</span> <span class="n">all_thresholds</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">mu_init</span><span class="o">=</span><span class="p">[</span><span class="mi">3000</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mu_prior_mu</span><span class="o">=</span><span class="p">[</span><span class="mi">3100</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">mu_prior_sd</span><span class="o">=</span><span class="p">[[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]],</span> <span class="n">imprimir</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of a variant of Markov Chain Monte-Carlo (MCMC). Given some prior</span>
<span class="sd">    information and a set of observations, this function performs MCMC. It calculates the posterior</span>
<span class="sd">    distribution of temperature and cost values and the lever values used in doing so.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        - observations (list of lists (N x 2)): Contains temperature and cost values.</span>
<span class="sd">        - all_levers_current (list): Current values of input levers.</span>
<span class="sd">        - all_thresholds (list of lists (48 x 2)): Each entry contains an upper and lower bound for each lever.</span>
<span class="sd">        - samples (int): Number of MCMC steps.</span>
<span class="sd">        - mu_init (list): Initial guess of temperature and cost values.</span>
<span class="sd">        - plot (boolean): Flag used for plotting.</span>
<span class="sd">        - mu_prior_mu (list): Mean temperature and cost values of prior distribution (assummed Gaussian).</span>
<span class="sd">        - mu_prior_sd (list of lists (2 x 2)): Diagonal matrix containing the standard deviation of the 2D prior.</span>
<span class="sd">        - imprimir (boolean): Flag used for printing useful information.</span>
<span class="sd">    Returns:</span>
<span class="sd">        - posterior (list of lists (N x 2)): Contains trace of all temperature and cost values.</span>
<span class="sd">        - accepted (list): Contains all the lever values corresponding the proposal accepted by MCMC.</span>
<span class="sd">        - rate (list): Contains the probability of each temperature and cost pair proposal.</span>
<span class="sd">        - accepted_values (list of lists (M x 2)): Contains accepted temperature and cost values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialisations</span>
    <span class="n">mu_current</span> <span class="o">=</span> <span class="n">mu_init</span> <span class="c1"># Set the current temperature and cost value</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu_current</span><span class="p">]</span> <span class="c1"># First value of the trace</span>
    <span class="n">accepted</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">accepted_values</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">rate</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="p">)</span> <span class="c1"># Get current URL (website must be TIAM-UCL&#39;s 2DS pathway)</span>

    <span class="c1"># Perform an MCMC step</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="n">all_levers_temp</span> <span class="o">=</span> <span class="n">all_levers_current</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Store current lever combination in a temp variable</span>

        <span class="c1"># Moves the calculator&#39;s levers using the sampler. Reads their corresponding temperature and cost values (proposal).</span>
        <span class="n">all_levers_current</span><span class="p">,</span> <span class="n">mu_proposal</span> <span class="o">=</span> <span class="n">generate_mu_proposal_2D</span><span class="p">(</span><span class="n">all_levers_current</span><span class="p">,</span> <span class="n">all_thresholds</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">address</span><span class="p">)</span>

        <span class="c1"># Compute likelihood ratio of proposed temperature and cost values</span>
        <span class="n">likelihood_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mu_proposal</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">]])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span> <span class="o">/</span> <span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mu_current</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">]])</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">observations</span><span class="p">))</span>

        <span class="c1"># Compute the prior probability ratio of the proposed temperature and cost values</span>
        <span class="n">prior_ratio</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mu_prior_mu</span><span class="p">,</span> <span class="n">mu_prior_sd</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">mu_proposal</span><span class="p">)</span> <span class="o">/</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mu_prior_mu</span><span class="p">,</span> <span class="n">mu_prior_sd</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">mu_current</span><span class="p">)</span>

        <span class="c1"># Probability of accepting the proposal</span>
        <span class="n">p_accept</span> <span class="o">=</span> <span class="n">likelihood_ratio</span><span class="o">*</span><span class="n">prior_ratio</span>
        <span class="n">rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_accept</span><span class="p">)</span>

        <span class="c1"># Printing routine</span>
        <span class="k">if</span> <span class="n">imprimir</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Current: &quot;</span><span class="p">,</span> <span class="n">mu_current</span><span class="p">,</span> <span class="s2">&quot; Proposal: &quot;</span><span class="p">,</span> <span class="n">mu_proposal</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Likelihood ratio: &quot;</span><span class="p">,</span> <span class="n">likelihood_ratio</span><span class="p">,</span> <span class="s2">&quot;Prior ratio: &quot;</span><span class="p">,</span> <span class="n">prior_ratio</span><span class="p">,</span> <span class="s2">&quot;Acceptance probability: &quot;</span><span class="p">,</span> <span class="n">p_accept</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Decide whether to accept or reject the temperature and cost values proposal</span>
        <span class="n">accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">p_accept</span>

        <span class="c1"># Temperature and cost values accepted</span>
        <span class="k">if</span> <span class="n">accept</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="p">)</span> <span class="c1"># Change URL address to current lever values (otherwise it remains the same)</span>
            <span class="n">mu_current</span> <span class="o">=</span> <span class="n">mu_proposal</span> <span class="c1"># Update current temperature and cost values</span>
            <span class="n">accepted</span> <span class="o">=</span> <span class="n">accepted</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="n">all_levers_current</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span> <span class="c1"># Save accepted combination of lever values</span>
            <span class="n">accepted_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mu_current</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span> <span class="c1"># Save accepted temperature and cost values</span>

        <span class="c1"># Temperature and cost values rejected</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_levers_current</span> <span class="o">=</span> <span class="n">all_levers_temp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Return lever values to last accepted iteration</span>

        <span class="c1"># Update trace of temperature and cost values</span>
        <span class="n">posterior</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mu_current</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">accepted</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">accepted_values</span>

<span class="k">def</span> <span class="nf">move_lever</span><span class="p">(</span><span class="n">lever</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets a lever to a given value. Reads corresponding temperature and, if selected, cost values.</span>
<span class="sd">    Parameters:</span>
<span class="sd">        - lever (list of strings): Contains the names of the levers to be moved.</span>
<span class="sd">        - value (list of floats): Contains the value of the levers to be moved - Automatically matched to lever names.</span>
<span class="sd">        - costs (optional, boolean): Flag to decide whether to read cost values or not.</span>
<span class="sd">        - address (optional, string): URL address corresponding to given lever combination.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Update URL address with input lever names and values, one at a time</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lever</span><span class="p">)):</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">new_URL</span><span class="p">(</span><span class="n">lever</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">address</span> <span class="o">=</span> <span class="n">address</span><span class="p">)</span>

    <span class="c1"># Open website corresponding to the input values</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

    <span class="c1">########################################## IMPORTANT ####################################################</span>
    <span class="c1"># All of the lines below are in charge of webscraping the temperature and, if selected, the cost values.</span>
    <span class="c1"># The Global Calculator is a hard to webscrape website (sometimes, it results in bugs or uncoherent</span>
    <span class="c1"># temperature and cost values). The code below ensures that, no matter what, the values will be read.</span>
    <span class="c1"># To do so it performs different actions based on the current state of the website and the output values.</span>
    <span class="c1">#########################################################################################################</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># Bypass &quot;Start&quot; screen</span>
    <span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Read temperature values</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_CO2</span><span class="p">()[:</span><span class="mi">4</span><span class="p">])</span> <span class="c1"># Read output CO2</span>
    <span class="k">except</span><span class="p">:</span> <span class="c1"># Problem reading output CO2? The code below sorts it</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">open_lever_menus</span><span class="p">()</span> <span class="c1"># Open lever menus</span>
        <span class="n">move_lever</span><span class="p">([</span><span class="n">lever</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="mf">1.3</span><span class="p">],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Move lever to an arbitrary value</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">address</span><span class="p">)</span> <span class="c1"># Open website back</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># Bypass &quot;Start&quot; screen</span>
        <span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_CO2</span><span class="p">()[:</span><span class="mi">4</span><span class="p">])</span> <span class="c1"># Read output CO2</span>

    <span class="c1"># Read cost values</span>
    <span class="k">if</span> <span class="n">costs</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;mn-6&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span> <span class="c1"># Move to compare tab</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;container_costs_vs_counterfactual&quot;]/div/div[11]&#39;</span><span class="p">)</span> <span class="c1"># Read GDP</span>
        <span class="n">cost_output</span> <span class="o">=</span> <span class="n">userid_element</span><span class="o">.</span><span class="n">text</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cost_output</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cost_output</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">))</span> <span class="c1"># Convert GDP from string to float</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># Problem converting GDP? The code below sorts it</span>
            <span class="n">cost_output</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cost_output</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">))</span>

        <span class="c1"># Reload the page and bypass start</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span> <span class="c1"># Refresh</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># Bypass &quot;Start&quot; screen</span>
        <span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;container_costs_vs_counterfactual&quot;]/div/div[12]&#39;</span><span class="p">)</span> <span class="c1"># Read text below GDP value</span>
        <span class="n">cost_flag</span> <span class="o">=</span> <span class="n">userid_element</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Find sign of GDP (less expensive =&gt; increase; more expensive =&gt; decrease)</span>
        <span class="k">if</span> <span class="n">cost_flag</span> <span class="o">==</span> <span class="s1">&#39;less expensive&#39;</span><span class="p">:</span>
            <span class="n">cost_output</span> <span class="o">=</span> <span class="o">-</span><span class="n">cost_output</span> <span class="c1"># Reverse sign</span>

        <span class="c1"># Go back to the overview section</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;mn-1&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="c1"># Problem going back to the overview section? The code below sorts it</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">id_box</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;lets-start&#39;</span><span class="p">)</span> <span class="c1"># Bypass &quot;Start&quot; screen</span>
            <span class="n">id_box</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="p">,</span> <span class="n">cost_output</span><span class="p">]</span> <span class="c1"># Output temperature and cost values</span>
    <span class="k">return</span>  <span class="n">output</span>

<span class="k">def</span> <span class="nf">save_all</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Save all accepted lever combinations, temperature and cost values, trace and probability values to a .XLSX file&quot;&quot;&quot;</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">posterior</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]));</span> <span class="c1"># Dataframe with posterior</span>
    <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rate</span> <span class="c1"># Append rate to it</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;MCMC_output_1.xlsx&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span> <span class="c1"># Open Excel file</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s1">&#39;MCMC_output_1.xlsx&#39;</span><span class="p">)</span> <span class="c1"># Load current workbook</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ws</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">ws</span><span class="p">)</span> <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">worksheets</span><span class="p">)</span> <span class="c1"># Load all sheets</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MCMC_output_1.xlsx&#39;</span><span class="p">)</span> <span class="c1"># Read current file</span>
    <span class="n">df1</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">startrow</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Write out the new sheet</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close Excel file</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accepted_inputs</span><span class="p">));</span>  <span class="c1"># Dataframe with accepted lever combinations</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;48&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accepted_values</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">];</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;49&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accepted_values</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">];</span> <span class="c1"># Append accepted temperature and cost values</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;MCMC_output_2.xlsx&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span> <span class="c1"># Open Excel file</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s1">&#39;MCMC_output_2.xlsx&#39;</span><span class="p">)</span> <span class="c1"># Load current workbook</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">ws</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">ws</span><span class="p">)</span> <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">worksheets</span><span class="p">)</span> <span class="c1"># Load all sheets</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MCMC_output_2.xlsx&#39;</span><span class="p">)</span> <span class="c1"># Read current file</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">startrow</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Write out the new sheet</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Close Excel file</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">set_lever</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">lever_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set a given lever (lever_name) to a value (target) by clicking on it - Using a minimum number of clicks.&quot;&quot;&quot;</span>
    <span class="n">n_clicks</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Set to 0 by default (&lt;=&gt; do nothing)</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="n">read_lever</span><span class="p">(</span><span class="n">lever_name</span><span class="p">))</span> <span class="c1"># Get lever id</span>
    <span class="n">current</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;textContent&#39;</span><span class="p">))</span> <span class="c1"># Read current lever value</span>

    <span class="c1"># Two possibilities: same box, or different box</span>
    <span class="n">jump</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">current</span>

    <span class="c1"># If the lever is already set</span>
    <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="n">current</span><span class="p">:</span>
        <span class="c1"># print(&quot;Current value = Target value&quot;)</span>
        <span class="n">box_number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

    <span class="c1"># Same box -&gt; 2 possibilities: up or down (down can hit boundary or not)</span>
    <span class="k">elif</span> <span class="n">jump</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#print(&quot;Same box case&quot;)</span>

        <span class="c1"># Up</span>
        <span class="c1"># Non boundary</span>
        <span class="n">box_number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># Current box</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#print(&quot;Lever up&quot;)</span>
            <span class="c1">#print(&quot;Non boundary&quot;)</span>
            <span class="n">n_clicks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(((</span><span class="n">current</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">current</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">target</span><span class="p">))</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Down</span>
        <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#print(&quot;Lever down&quot;)</span>

            <span class="c1"># Non boundary</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">%</span><span class="k">math</span>.trunc(target) != 0:
                <span class="c1">#print(&quot;Non boundary&quot;)</span>
                <span class="n">n_clicks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="o">*</span><span class="mi">10</span><span class="p">)))</span>

            <span class="c1"># Boundary: click previous level, then current</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#print(&quot;Boundary&quot;)</span>
                <span class="n">n_clicks</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Clicking done here (do not click later on)</span>

                <span class="c1"># Watch out for boundary case: box number 1</span>
                <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1">#print(&quot;Special case = 1&quot;)</span>
                    <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="n">find_lever_ref</span><span class="p">(</span><span class="n">lever_name</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">userid_element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="n">find_lever_ref</span><span class="p">(</span><span class="n">lever_name</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">box_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">userid_element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="c1"># Different box -&gt; 2 possibilities: up or down (each can be boundary or non boundary)</span>
    <span class="k">elif</span> <span class="n">jump</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#print (&quot;Different box case&quot;)</span>
        <span class="n">box_number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># Current box (default)</span>
        <span class="c1"># Up</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#print(&quot;Lever up&quot;)</span>

            <span class="c1"># Boundary</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">%</span><span class="k">math</span>.trunc(target) == 0:
                <span class="k">if</span> <span class="n">jump</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1">#print(&quot;Special case - Different box, boundary closest box&quot;)</span>
                    <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="n">find_lever_ref</span><span class="p">(</span><span class="n">lever_name</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">box_number</span><span class="o">+</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">userid_element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                    <span class="n">box_number</span> <span class="o">=</span> <span class="n">target</span>
                    <span class="n">n_clicks</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#print(&quot;Boundary&quot;)</span>
                    <span class="n">box_number</span> <span class="o">=</span> <span class="n">target</span>
                    <span class="n">n_clicks</span> <span class="o">=</span> <span class="mi">1</span>

       <span class="c1"># Non boundary</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#print(&quot;Non boundary&quot;)</span>
                <span class="n">box_number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="n">find_lever_ref</span><span class="p">(</span><span class="n">lever_name</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">box_number</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">userid_element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">n_clicks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span>

        <span class="c1"># Down</span>
        <span class="k">elif</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#print(&quot;Lever down&quot;)</span>

            <span class="c1"># Boundary</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">%</span><span class="k">math</span>.trunc(target) == 0:
                <span class="c1">#print(&quot;Boundary&quot;)</span>
                <span class="n">box_number</span> <span class="o">=</span> <span class="n">target</span>
                <span class="n">n_clicks</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Non boundary</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#print(&quot;Non boundary&quot;)</span>
                <span class="n">box_number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="n">find_lever_ref</span><span class="p">(</span><span class="n">lever_name</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">box_number</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">userid_element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">n_clicks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">userid_element</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_xpath</span><span class="p">(</span><span class="n">find_lever_ref</span><span class="p">(</span><span class="n">lever_name</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">box_number</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#print(&quot;Number of clicks: &quot;, n_clicks)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_clicks</span><span class="p">):</span>
        <span class="n">userid_element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CO2 emissions: &quot;</span><span class="p">,</span> <span class="n">read_CO2</span><span class="p">(),</span> <span class="s2">&quot; </span><span class="se">\t</span><span class="s2"> Meets 2C target?&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_CO2</span><span class="p">()[:</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3010</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s1">&#39;/html/body/table[1]/tbody/tr/td/table/tbody/tr[1]/td/table/tbody/tr[1]/td[1]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="c1"># move mouse away to avoid collisions</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_lever_values</span> <span class="o">=</span> <span class="n">new_lever_combination</span><span class="p">()</span> <span class="c1"># Generate random lever combination</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">move_lever</span><span class="p">(</span><span class="n">lever_names</span><span class="p">,</span> <span class="n">random_lever_values</span><span class="p">,</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Move lever accordingly</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_sensitivity</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">costs_sensitivity</span> <span class="o">=</span>  <span class="p">[]</span>
<span class="k">for</span> <span class="n">lever</span> <span class="ow">in</span> <span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span> <span class="c1"># Move each lever to 3 at a time</span>
    <span class="n">address</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving lever: &quot;</span><span class="p">,</span> <span class="n">lever</span><span class="p">)</span>
    <span class="n">costs_temp</span> <span class="o">=</span> <span class="n">move_lever</span><span class="p">([</span><span class="n">lever</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">address</span><span class="p">)</span>
    <span class="n">costs_sensitivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">costs_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">temp_sensitivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">costs_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Marginal cost: &quot;</span><span class="p">,</span> <span class="n">costs_temp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Returning lever back to normal... </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">move_lever</span><span class="p">([</span><span class="n">lever</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">address</span><span class="p">)</span> <span class="c1"># Put the lever back to 2</span>

<span class="n">reference</span> <span class="o">=</span> <span class="n">move_lever</span><span class="p">([</span><span class="s1">&#39;Calories consumed&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Read the benchmark cost</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Lever&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="c1"># Dictionary containing costs and lever names</span>
        <span class="s1">&#39;Marginal cost&#39;</span><span class="p">:</span> <span class="n">costs_sensitivity</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Lever&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="c1"># Dictionary containing costs and lever names</span>
        <span class="s1">&#39;Marginal cost&#39;</span><span class="p">:</span> <span class="n">costs_sensitivity</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lever&#39;</span><span class="p">,</span> <span class="s1">&#39;Marginal cost&#39;</span><span class="p">])</span> <span class="c1"># Put cost values into dataframe</span>
<span class="n">costs_df</span> <span class="o">=</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Marginal cost&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Sort costs</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.24</span>
<span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.21</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs_df</span> <span class="o">=</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Marginal cost&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Sort cost</span>
<span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="temperature-sensitivity-analysis">
<h1>Temperature sensitivity analysis<a class="headerlink" href="#temperature-sensitivity-analysis" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># find_lever_sensitivities() # Disabled by default (takes a while)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Plotting routine ###</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Decrease in GHG emissions per capita to 2050&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Decrease in GHG emissions per capita to 2050 – All levers set to 2, moving each lever from 2 to 3&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Decrease in GHG emissions per capita to 2050 – All levers set to 2, moving each lever from 2 to 3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_19_1.png" src="../../_images/output_19_1.png" />
</div>
<div class="section" id="cost-sensitivity-analysis">
<h1>Cost sensitivity analysis<a class="headerlink" href="#cost-sensitivity-analysis" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># cost_sensitivity() # Disabled by default (takes a while)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Plotting routine ###</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">costs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Increase in GDP wrt business as usual pathway&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Increase in GDP wrt business as usual pathway – All levers set to 2, moving each lever from 2 to 3&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Increase in GDP wrt business as usual pathway – All levers set to 2, moving each lever from 2 to 3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_22_1.png" src="../../_images/output_22_1.png" />
</div>
<div class="section" id="generalising-mcmc-2-constraints-to-all-levers">
<h1>Generalising MCMC (2 constraints) to all levers<a class="headerlink" href="#generalising-mcmc-2-constraints-to-all-levers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="unbounded-prior-for-all-levers">
<h2>Unbounded prior for all levers<a class="headerlink" href="#unbounded-prior-for-all-levers" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lever_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span> <span class="c1"># Create list with all lever names</span>
<span class="n">lever_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">300</span><span class="p">):</span> <span class="c1"># Draw 300 samples from the prior</span>
    <span class="n">random_lever_values</span> <span class="o">=</span> <span class="n">new_lever_combination</span><span class="p">()</span> <span class="c1"># Generate random lever combination</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">move_lever</span><span class="p">(</span><span class="n">lever_names</span><span class="p">,</span> <span class="n">random_lever_values</span><span class="p">,</span> <span class="n">costs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># Move lever accordingly</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">14</span><span class="p">):</span> <span class="c1"># Check for spurious values</span>
        <span class="n">lever_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change format of prior values: from data pairs to separate lists of observations</span>
<span class="n">x_val</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">y_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lever_values</span><span class="p">:</span>
    <span class="n">x_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">y_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">lever_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate mean and standard deviation of the randomly sampled temperature and cost values</span>
<span class="n">mu_1</span><span class="p">,</span> <span class="n">mu_2</span><span class="p">,</span> <span class="n">sigma_1</span><span class="p">,</span> <span class="n">sigma_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lever_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lever_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lever_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lever_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Values below are a good approximation</span>
<span class="c1">#mu_1, mu_2, sigma_1, sigma_2 = (3436.1744680851066, -2.639191489361702, 18204.97972378225, 34.59578098974829)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters to set</span>
<span class="n">mu_x</span> <span class="p">,</span><span class="n">variance_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">,</span> <span class="n">variance_y</span> <span class="o">=</span> <span class="n">mu_1</span><span class="p">,</span> <span class="n">sigma_1</span><span class="p">,</span> <span class="n">mu_2</span><span class="p">,</span> <span class="n">sigma_2</span>

<span class="c1"># Create grid and multivariate normal</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2800</span><span class="p">,</span><span class="mi">3800</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">;</span> <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span>
<span class="n">rv</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">([</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y</span><span class="p">]])</span>

<span class="c1"># 3D plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;GtCO2 emissions per capita&#39;</span><span class="p">,</span> <span class="n">linespacing</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span><span class="s1">&#39;$\Delta$GDP&#39;</span><span class="p">,</span> <span class="n">linespacing</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="n">linespacing</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/output_28_0.png" src="../../_images/output_28_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">axis</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Contour plot of prior probabilities of temperature and cost values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$GDP&quot;</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">Text(0, 0.5, '$\Delta$GDP')</pre>
<img alt="../../_images/output_29_1.png" src="../../_images/output_29_1.png" />
</div>
<div class="section" id="generating-observations">
<h2>Generating observations<a class="headerlink" href="#generating-observations" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw random normal temperature value</span>
<span class="n">temp_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">2850</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="c1"># Draw random normal cost value</span>
<span class="n">cost_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">cost_vals</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">20</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Empirical distribution of randomly generated cost observations&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$GDP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">temp_vals</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Empirical distribution of randomly generated temperature observations&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_32_1.png" src="../../_images/output_32_1.png" />
<img alt="../../_images/output_32_2.png" src="../../_images/output_32_2.png" />
</div>
<div class="section" id="defining-a-likelihood-function">
<h2>Defining a likelihood function<a class="headerlink" href="#defining-a-likelihood-function" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The parameters below have been empirically adjusted to obtain a reasonable MCMC convergence with optimal acceptance rate</span>
<span class="n">mu_x</span><span class="p">,</span> <span class="n">variance_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">,</span> <span class="n">variance_y</span> <span class="o">=</span> <span class="mi">2850</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span>

<span class="c1"># Create grid and multivariate normal</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">;</span> <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span>
<span class="n">rv</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">([</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y</span><span class="p">]])</span>

<span class="c1"># 3D plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_vals</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">temp_vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cost_vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$GDP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Temperature and cost observations and contours of likelihood function&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Temperature and cost observations and contours of likelihood function&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_34_1.png" src="../../_images/output_34_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct observations array (as pairs of data)</span>
<span class="n">observations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">temp_vals</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">cost_vals</span><span class="p">)]</span>
<span class="n">observations</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_vals</span><span class="p">)):</span>
    <span class="n">observations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">temp_vals</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cost_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-mcmc-and-logging-results">
<h1>Running MCMC and logging results<a class="headerlink" href="#running-mcmc-and-logging-results" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run MCMC for 7000 (700x10) samples. Save results after every 700 samples.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>

    <span class="c1"># Initial lever values (corresponding to UCL TIAM 2DS pathway)</span>
    <span class="n">set_to_benchmark</span><span class="p">()</span>
    <span class="n">initial_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>

    <span class="c1"># Run MCMC</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">posterior</span><span class="p">,</span> <span class="n">accepted_inputs</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">accepted_values</span> <span class="o">=</span> <span class="n">multi_sampler_2D</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">,</span> <span class="n">no_thresholds</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">mu_init</span><span class="o">=</span><span class="p">[</span><span class="mi">2400</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">],</span> <span class="n">mu_prior_mu</span><span class="o">=</span><span class="p">[</span><span class="n">mu_1</span><span class="p">,</span> <span class="n">mu_2</span><span class="p">],</span> <span class="n">mu_prior_sd</span><span class="o">=</span><span class="p">[[</span><span class="n">sigma_1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma_2</span><span class="p">]],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">imprimir</span> <span class="o">=</span> <span class="kc">True</span><span class="p">);</span>

    <span class="c1"># If there is a problem with the website and the algorithm breaks, restart and try again</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Broke in iteration: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">set_to_benchmark</span><span class="p">()</span>

    <span class="c1"># Save all values</span>
    <span class="n">save_all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-pre-computed-results-24-hours-long-markov-chain">
<h1>Loading pre-computed results (24-hours long Markov Chain)<a class="headerlink" href="#loading-pre-computed-results-24-hours-long-markov-chain" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read output values</span>
<span class="n">dfs_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;MCMC_output_2.xlsx&quot;</span><span class="p">)</span> <span class="c1"># file mapping lever names to xpaths</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rearrange lever names - Not fully ordered by default</span>
<span class="n">lever_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">lever_names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Product lifespan &amp; demand&#39;</span><span class="p">)</span>
<span class="n">lever_names</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;Product lifespan &amp; demand&#39;</span><span class="p">)</span>
<span class="n">dfs_4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">],</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">15</span><span class="p">],</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">],</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">16</span><span class="p">:]],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfs_4</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="o">=</span> <span class="n">lever_names</span>
</pre></div>
</div>
</div>
<div class="section" id="correlation-matrix-of-accepted-mcmc-lever-combinations">
<h1>Correlation matrix of accepted MCMC lever combinations<a class="headerlink" href="#correlation-matrix-of-accepted-mcmc-lever-combinations" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">NonLinCdict</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">hexcol_array</span><span class="p">):</span>
    <span class="n">cdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="p">(),</span> <span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="p">(),</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="p">()}</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">hexcol</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">hexcol_array</span><span class="p">):</span>
        <span class="n">rgb</span> <span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">hex2color</span><span class="p">(</span><span class="n">hexcol</span><span class="p">)</span>
        <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]),)</span>
        <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]),)</span>
        <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]),)</span>
    <span class="k">return</span> <span class="n">cdict</span>

<span class="n">hc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#b30000&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;#002db3&#39;</span><span class="p">]</span>
<span class="n">th</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]</span>

<span class="n">cdict</span> <span class="o">=</span> <span class="n">NonLinCdict</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">hc</span><span class="p">)</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">cdict</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span> <span class="o">=</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">48</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x25435f54d48</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../../_images/output_45_11.png" src="../../_images/output_45_11.png" />
</div>
<div class="section" id="paired-density-and-scatter-plot-matrix-of-lever-combinations-accepted-by-mcmc">
<h1>Paired density and scatter plot matrix of lever combinations accepted by MCMC<a class="headerlink" href="#paired-density-and-scatter-plot-matrix-of-lever-combinations-accepted-by-mcmc" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">figsize</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
                               <span class="n">marker</span>   <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">diagonal</span> <span class="o">=</span> <span class="s2">&quot;kde&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x00000172F76E6F08</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x00000172829BB248</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x00000172829F1A88</span><span class="o">&gt;</span><span class="p">],</span>
       <span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000017282A27908</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000017282A60A48</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000017282A9AAC8</span><span class="o">&gt;</span><span class="p">],</span>
       <span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000017282AD2888</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000017282B09D08</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000017282B148C8</span><span class="o">&gt;</span><span class="p">]],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_47_1.png" src="../../_images/output_47_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;Output_map.xlsx&quot;</span><span class="p">)</span> <span class="c1"># file mapping output lever names to xpaths</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read output values</span>
<span class="n">output_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;training_test_set.xlsx&quot;</span><span class="p">)</span> <span class="c1"># file mapping lever names to xpaths</span>
<span class="n">new_df</span><span class="o">=</span><span class="p">(</span><span class="n">output_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">49</span><span class="p">:]</span><span class="o">-</span><span class="n">output_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">49</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">output_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">49</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List outputs</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
<pre class="literal-block">array(['GHG emissions (t CO2e) per capita',
       'Cumulative emissions by 2100 (Gt CO2e)',
       'Population (billions of people)', '% population in urban areas',
       'Total energy supply (EJ / year)',
       'Total energy demand (EJ / year)',
       'Energy demand (kWh / capita / year)',
       'Proportion of primary energy from fossil fuels',
       'Bioenergy supply (EJ / year)',
       'Electricity demand (kWh / capita /year)', 'Wind capacity (GW)',
       'Solar capacity (GW)', 'Nuclear capacity (GW)',
       'Hydro-electric capacity (GW)', 'GGS for power (GW)',
       'Storage capacity (GW)',
       'Efficiency of CCS fossil fuel power generation',
       'Emissions intensity (global average g CO2e / kWh)',
       'Number of passenger vehicles on the road (thousands)',
       '% urban cars that are zero emission (electric/hydrogen)',
       'Efficiency of average global car (litres gasoline equivalent per 100km)',
       'Total domestic passenger km travelled each year per capita (including walking, cycles, motorcycles, cars and public transport, but not international/plane travel)',
       'Total passenger km travelled each year per capita (includes domestic, international and plane travel)',
       '% of passenger km travelled using cars (out of total domestic&amp;international km travelled)',
       'Distance travelledxa0per personxa0by air (global average)',
       'Domestic freight (Tonne km / capita / year)',
       'International freight (Tonne km / capita / year)',
       'Proportion of international freight by air',
       'Number of appliances per household',
       'Number of washing machines in an average urban household',
       'Refrigerator average power (W) in urban areas',
       'Building temperature in warm months (⁰C)',
       'Building temperature in cold months (⁰C)',
       'Home/building insulation (rate of heat loss in GW / M ha*℃)',
       '% urban heating provided from zero carbon technologies (solar, heat pumps) or electric for heating',
       'Global % of households that have access to electricity',
       'Iron, steel and aluminium output (Gt / year)',
       'Paper and other output (Gt / year)',
       'Chemicals output (Gt / year)', 'Cement output (Gt / year)',
       'Timber output (Gt / year)',
       'Global Oxygen steel technology (% decrease in energy demand from 2011)',
       'Global Pulp &amp; paper: Pulp technology (% decrease in energy demand from 2011)',
       'Global Chemicals: High Value Chemicals technology (% decrease in energy demand from 2011)',
       'Global Cement technology (% decrease in energy demand from 2011)',
       'Demand for consumer packaging (% of 2011 tonne demand)',
       'Demand for electrical equipment (% of 2011 tonne demand)',
       'Lifespan of refrigerator (years) in urban areas',
       'Crop yield growth from 2011',
       'Average number of cows per hectare (pasture fed only)',
       'Proportion of cows fed from gains/residues and farmed in confined systems',
       'Bioenergy area (millions of hectares).',
       'Forest area (native and commercial, millions of hectares',
       'Calories consumed per head (kcal / person / day)',
       'Calories from meat (kcal / person / day)'], dtype=object)</pre>
</div>
<div class="section" id="correlation-matrix-of-output-values">
<h1>Correlation matrix of output values<a class="headerlink" href="#correlation-matrix-of-output-values" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="n">dfs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
    <span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">corr</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x254265b2048</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../../_images/output_55_1.png" src="../../_images/output_55_1.png" />
</div>
<div class="section" id="export-correlation-data-to-gephi">
<h1>Export correlation data to GEPHI<a class="headerlink" href="#export-correlation-data-to-gephi" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="c1">#Calculate the correlation between individuals. We have to transpose first, because the corr function calculate the pairwise correlations between columns.</span>
<span class="c1">#corr = df.corr()</span>
<span class="c1">#corr = cov</span>

<span class="c1"># Transform it in a links data frame (3 columns only):</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">links</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;var1&#39;</span><span class="p">,</span> <span class="s1">&#39;var2&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<span class="n">links</span>

<span class="c1"># Keep only correlation over a threshold and remove self correlation (cor(A,A)=1)</span>
<span class="n">links_filtered</span><span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">((</span><span class="n">links</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="s1">&#39;var1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">links</span><span class="p">[</span><span class="s1">&#39;var2&#39;</span><span class="p">]))</span> <span class="o">|</span> <span class="p">((</span><span class="n">links</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>  <span class="o">&gt;</span> <span class="mf">0.23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="s1">&#39;var1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">links</span><span class="p">[</span><span class="s1">&#39;var2&#39;</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">]</span>
<span class="c1"># links_filtered=links.loc[ (links[&#39;value&#39;] &lt; -0.7) &amp; (links[&#39;var1&#39;] != links[&#39;var2&#39;]) ]</span>
<span class="n">links_filtered</span>

<span class="c1"># Build your graph</span>
<span class="n">G</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">links_filtered</span><span class="p">,</span> <span class="s1">&#39;var1&#39;</span><span class="p">,</span> <span class="s1">&#39;var2&#39;</span><span class="p">,</span> <span class="n">edge_attr</span><span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">write_gexf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s2">&quot;file_MCMC.gexf&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.2draft&quot;</span><span class="p">)</span>
<span class="c1">#nx.draw(G, with_labels=True, node_color=&#39;red&#39;, node_size=100, edge_color=&#39;black&#39;, linewidths=1, font_size=20)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">links_filtered</span>
</pre></div>
</div>
</div>
<div class="section" id="posterior-distribution-of-accepted-mcmc-lever-combinations">
<h1>Posterior distribution of accepted MCMC lever combinations<a class="headerlink" href="#posterior-distribution-of-accepted-mcmc-lever-combinations" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set figure and colour</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s2">&quot;pastel&quot;</span><span class="p">,</span> <span class="n">n_colors</span> <span class="o">=</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Indexes for subplots</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>


<span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mf">17.0</span><span class="p">,</span> <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">rc</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="n">rc</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="c1">#sns.set(font_scale=15)</span>
<span class="c1"># Iterate through all data</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">47</span><span class="p">]:</span> <span class="c1"># If the group of levers changes, change colour</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>

    <span class="c1"># Plot histogram</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">values</span><span class="p">,</span>  <span class="n">kde</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">lever_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; - $\mu$: &quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;; $\sigma$: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Lever values&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="c1">#axes[row, col].xlabel(&#39;Lever values&#39;)</span>
    <span class="c1">#axes[row, col].ylabel(&#39;Frequency&#39;)</span>
    <span class="c1"># Set subplot indexes</span>
    <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">col</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">#</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/output_60_0.png" src="../../_images/output_60_0.png" />
</div>
<div class="section" id="posterior-distribution-of-model-outputs-accepted-by-mcmc">
<h1>Posterior distribution of model outputs accepted by MCMC<a class="headerlink" href="#posterior-distribution-of-model-outputs-accepted-by-mcmc" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read more output values</span>
<span class="n">dfs_5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;MCMC_output_1.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Discard first iterations of MCMC</span>
<span class="n">dfs_5</span> <span class="o">=</span> <span class="n">dfs_5</span><span class="p">[</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2750</span><span class="p">]</span>
<span class="n">dfs_5</span> <span class="o">=</span> <span class="n">dfs_5</span><span class="p">[</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3250</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting routine</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Solution space - GtCO2 emissions per capita and $\Delta$GDP samples&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$GDP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">2600</span><span class="p">,</span> <span class="mi">3300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_63_1.png" src="../../_images/output_63_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct dataframe for joint plot</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GtCO2 emissions per capita&#39;</span><span class="p">,</span> <span class="s1">&#39;$\Delta$GDP&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="s2">&quot;GtCO2 emissions per capita&quot;</span><span class="p">,</span> <span class="s2">&quot;$\Delta$GDP&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/output_65_0.png" src="../../_images/output_65_0.png" />
<div class="section" id="evolution-of-temperature-values">
<h2>Evolution of temperature values<a class="headerlink" href="#evolution-of-temperature-values" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting routine</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Trace of accepted GtCO2 emissions per capita values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sample&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">2700</span><span class="p">,</span> <span class="mi">3300</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2700</span><span class="p">,</span> <span class="mi">3300</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_67_1.png" src="../../_images/output_67_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting routine</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram of GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mu: &quot;</span><span class="p">,</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s2">&quot;; Sigma: &quot;</span><span class="p">,</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mu</span><span class="p">:</span>  <span class="mf">2971.446327683616</span> <span class="p">;</span> <span class="n">Sigma</span><span class="p">:</span>  <span class="mf">73.90502290463505</span>
</pre></div>
</div>
<img alt="../../_images/output_68_1.png" src="../../_images/output_68_1.png" />
</div>
<div class="section" id="evolution-of-cost-values">
<h2>Evolution of cost values<a class="headerlink" href="#evolution-of-cost-values" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evolution of cost values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Trace of accepted $\Delta$GDP values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sample&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$GDP value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_70_1.png" src="../../_images/output_70_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting routine</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram of $\Delta$GDP values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$GDP values&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mu: &quot;</span><span class="p">,</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="s2">&quot;; Sigma: &quot;</span><span class="p">,</span> <span class="n">dfs_4</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mu</span><span class="p">:</span>  <span class="o">-</span><span class="mf">0.048114215910825986</span> <span class="p">;</span> <span class="n">Sigma</span><span class="p">:</span>  <span class="mf">0.728568148578964</span>
</pre></div>
</div>
<img alt="../../_images/output_71_1.png" src="../../_images/output_71_1.png" />
</div>
</div>
<div class="section" id="acceptance-rate">
<h1>Acceptance rate<a class="headerlink" href="#acceptance-rate" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evolution of acceptance rate</span>
<span class="n">dfs_5</span> <span class="o">=</span> <span class="n">dfs_5</span><span class="p">[</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Acceptance rate (un-smoothed)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sample&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;MCMC acceptance probability&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_73_1.png" src="../../_images/output_73_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">moving_average</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Simple moving average filter&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">ret</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ret</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">n</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter acceptance rate with MA filter (window length = 1000)</span>
<span class="n">ma_rate</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting routine</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Acceptance rate (smoothed with moving average filter)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sample&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;MCMC acceptance probability&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ma_rate</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_76_1.png" src="../../_images/output_76_1.png" />
</div>
<div class="section" id="autocorrelation-function-of-accepted-model-outputs">
<h1>Autocorrelation function of accepted model outputs<a class="headerlink" href="#autocorrelation-function-of-accepted-model-outputs" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Autocorrelation of temperature values</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Autocorrelation of GtCO2 emissions per capita&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Shift&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Correlation coefficient&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/output_78_0.png" src="../../_images/output_78_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Autocorrelation of cost values</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs_5</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Autocorrelation of $\Delta$GDP values&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Shift&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Correlation coefficient&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="examples/MCMC/output_79_0.png" src="examples/MCMC/output_79_0.png" />
</div>
<div class="section" id="summary-of-inputs-to-the-global-calculator">
<h1>Summary of inputs to the Global Calculator<a class="headerlink" href="#summary-of-inputs-to-the-global-calculator" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">lever</span> <span class="ow">in</span> <span class="n">dfs_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lever</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Global</span> <span class="n">population</span>
<span class="n">Urbanisation</span>
<span class="n">Passenger</span> <span class="n">distance</span>
<span class="n">Freight</span> <span class="n">distance</span>
<span class="n">Mode</span>
<span class="n">Occupancy</span> <span class="o">&amp;</span> <span class="n">load</span>
<span class="n">Car</span> <span class="n">own</span> <span class="n">hire</span>
<span class="n">Transport</span> <span class="n">efficiency</span>
<span class="n">Electric</span> <span class="o">&amp;</span> <span class="n">hydrogen</span>
<span class="n">Building</span> <span class="n">size</span>
<span class="n">Temperature</span> <span class="o">&amp;</span> <span class="n">hot</span> <span class="n">water</span> <span class="n">use</span>
<span class="n">Lighting</span> <span class="o">&amp;</span> <span class="n">appliance</span> <span class="n">use</span>
<span class="n">Building</span> <span class="n">insultion</span>
<span class="n">Temperature</span> <span class="ow">and</span> <span class="n">cooking</span> <span class="n">technology</span>
<span class="n">Appliance</span> <span class="n">efficiency</span>
<span class="n">Product</span> <span class="n">lifespan</span> <span class="o">&amp;</span> <span class="n">demand</span>
<span class="n">Design</span><span class="p">,</span> <span class="n">materials</span> <span class="o">&amp;</span> <span class="n">recycling</span>
<span class="n">Iron</span><span class="p">,</span> <span class="n">steel</span> <span class="o">&amp;</span> <span class="n">aluminium</span>
<span class="n">Chemicals</span>
<span class="n">Paper</span> <span class="o">&amp;</span> <span class="n">other</span>
<span class="n">Cement</span>
<span class="n">CCS</span> <span class="n">manufacturing</span>
<span class="n">CCS</span> <span class="n">electricity</span>
<span class="n">Coal</span> <span class="o">/</span> <span class="n">oil</span> <span class="o">/</span> <span class="n">gas</span>
<span class="n">Fossil</span> <span class="n">fuel</span> <span class="n">efficiency</span>
<span class="n">Nuclear</span>
<span class="n">Wind</span>
<span class="n">Hydroelectric</span>
<span class="n">Marine</span>
<span class="n">Solar</span>
<span class="n">Geothermal</span>
<span class="n">Storage</span> <span class="o">&amp;</span> <span class="n">demand</span> <span class="n">shifting</span>
<span class="n">Calories</span> <span class="n">consumed</span>
<span class="n">Quantitiy</span> <span class="n">of</span> <span class="n">meat</span>
<span class="n">Type</span> <span class="n">of</span> <span class="n">meat</span>
<span class="n">Crop</span> <span class="n">yields</span>
<span class="n">Livestock</span> <span class="n">grains</span><span class="o">/</span><span class="n">residues</span> <span class="n">fed</span>
<span class="n">Livestock</span> <span class="n">pasture</span> <span class="n">fed</span>
<span class="n">Wastes</span> <span class="o">&amp;</span> <span class="n">residues</span>
<span class="n">Bioenergy</span> <span class="n">yields</span>
<span class="n">Solid</span> <span class="ow">or</span> <span class="n">liquid</span>
<span class="n">Surplus</span> <span class="n">land</span> <span class="n">forest</span> <span class="o">&amp;</span> <span class="n">bioenergy</span>
<span class="n">Land</span><span class="o">-</span><span class="n">use</span> <span class="n">efficiency</span>
<span class="n">GGR1</span>
<span class="n">GGR2</span>
<span class="n">GGR3</span>
<span class="n">GGR4</span>
<span class="n">Emissions</span> <span class="n">trajectory</span>
</pre></div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Jorge Garcia.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>